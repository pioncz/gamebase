<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
<![endif]-->

<!-- Add your site or application content here -->
<p>Hello world! This is HTML5 Boilerplate.</p>
<script>


  let fields = [
    {
      "x": 0,
      "z": 4,
      "playerId": 3,
      "type": "start"
    },
    {
      "x": 1,
      "z": 4
    },
    {
      "x": 2,
      "z": 4
    },
    {
      "x": 3,
      "z": 4
    },
    {
      "x": 4,
      "z": 4
    },
    {
      "x": 4,
      "z": 3
    },
    {
      "x": 4,
      "z": 2
    },
    {
      "x": 4,
      "z": 1
    },
    {
      "x": 4,
      "z": 0
    },
    {
      "x": 5,
      "z": 0
    },
    {
      "x": 5,
      "z": 1,
      "playerId": 0,
      "type": "goal"
    },
    {
      "x": 5,
      "z": 2,
      "playerId": 0,
      "type": "goal"
    },
    {
      "x": 5,
      "z": 3,
      "playerId": 0,
      "type": "goal"
    },
    {
      "x": 5,
      "z": 4,
      "playerId": 0,
      "type": "goal"
    },
    {
      "x": 9,
      "z": 0,
      "playerId": 0,
      "type": "spawn"
    },
    {
      "x": 10,
      "z": 0,
      "playerId": 0,
      "type": "spawn"
    },
    {
      "x": 9,
      "z": 1,
      "playerId": 0,
      "type": "spawn"
    },
    {
      "x": 10,
      "z": 1,
      "playerId": 0,
      "type": "spawn"
    },
    {
      "x": 6,
      "z": 0,
      "playerId": 0,
      "type": "start"
    },
    {
      "x": 6,
      "z": 1
    },
    {
      "x": 6,
      "z": 2
    },
    {
      "x": 6,
      "z": 3
    },
    {
      "x": 6,
      "z": 4
    },
    {
      "x": 7,
      "z": 4
    },
    {
      "x": 8,
      "z": 4
    },
    {
      "x": 9,
      "z": 4
    },
    {
      "x": 10,
      "z": 4
    },
    {
      "x": 10,
      "z": 5
    },
    {
      "x": 9,
      "z": 5,
      "playerId": 1,
      "type": "goal"
    },
    {
      "x": 8,
      "z": 5,
      "playerId": 1,
      "type": "goal"
    },
    {
      "x": 7,
      "z": 5,
      "playerId": 1,
      "type": "goal"
    },
    {
      "x": 6,
      "z": 5,
      "playerId": 1,
      "type": "goal"
    },
    {
      "x": 9,
      "z": 9,
      "playerId": 1,
      "type": "spawn"
    },
    {
      "x": 10,
      "z": 9,
      "playerId": 1,
      "type": "spawn"
    },
    {
      "x": 9,
      "z": 10,
      "playerId": 1,
      "type": "spawn"
    },
    {
      "x": 10,
      "z": 10,
      "playerId": 1,
      "type": "spawn"
    },
    {
      "x": 10,
      "z": 6,
      "playerId": 1,
      "type": "start"
    },
    {
      "x": 9,
      "z": 6
    },
    {
      "x": 8,
      "z": 6
    },
    {
      "x": 7,
      "z": 6
    },
    {
      "x": 6,
      "z": 6
    },
    {
      "x": 6,
      "z": 7
    },
    {
      "x": 6,
      "z": 8
    },
    {
      "x": 6,
      "z": 9
    },
    {
      "x": 6,
      "z": 10
    },
    {
      "x": 5,
      "z": 10
    },
    {
      "x": 5,
      "z": 9,
      "playerId": 2,
      "type": "goal"
    },
    {
      "x": 5,
      "z": 8,
      "playerId": 2,
      "type": "goal"
    },
    {
      "x": 5,
      "z": 7,
      "playerId": 2,
      "type": "goal"
    },
    {
      "x": 5,
      "z": 6,
      "playerId": 2,
      "type": "goal"
    },
    {
      "x": 0,
      "z": 9,
      "playerId": 2,
      "type": "spawn"
    },
    {
      "x": 1,
      "z": 9,
      "playerId": 2,
      "type": "spawn"
    },
    {
      "x": 0,
      "z": 10,
      "playerId": 2,
      "type": "spawn"
    },
    {
      "x": 1,
      "z": 10,
      "playerId": 2,
      "type": "spawn"
    },
    {
      "x": 4,
      "z": 10,
      "playerId": 2,
      "type": "start"
    },
    {
      "x": 4,
      "z": 9
    },
    {
      "x": 4,
      "z": 8
    },
    {
      "x": 4,
      "z": 7
    },
    {
      "x": 4,
      "z": 6
    },
    {
      "x": 3,
      "z": 6
    },
    {
      "x": 2,
      "z": 6
    },
    {
      "x": 1,
      "z": 6
    },
    {
      "x": 0,
      "z": 6
    },
    {
      "x": 0,
      "z": 5
    },
    {
      "x": 1,
      "z": 5,
      "playerId": 3,
      "type": "goal"
    },
    {
      "x": 2,
      "z": 5,
      "playerId": 3,
      "type": "goal"
    },
    {
      "x": 3,
      "z": 5,
      "playerId": 3,
      "type": "goal"
    },
    {
      "x": 4,
      "z": 5,
      "playerId": 3,
      "type": "goal"
    },
    {
      "x": 0,
      "z": 0,
      "playerId": 3,
      "type": "spawn"
    },
    {
      "x": 1,
      "z": 0,
      "playerId": 3,
      "type": "spawn"
    },
    {
      "x": 0,
      "z": 1,
      "playerId": 3,
      "type": "spawn"
    },
    {
      "x": 1,
      "z": 1,
      "playerId": 3,
      "type": "spawn"
    }
  ];

  const FieldType = {
    spawn: 'spawn',
    start: 'start',
    goal: 'goal',
  };

  let checkField = ({startField, endField, diceNumber, pawn}) => {
    if (endField.type === FieldType.goal && endField.playerId !== pawn.playerId) {
      return false;
    }
    if (endField.type === FieldType.spawn) {
      return false;
    }

    return true;
  };

  let log = (m)=>{console.log(m);};
  let movePawn = ({pawns, diceNumber}) => {
    let endField,
      length = 0,
      pawn = pawns[0],
      areFieldsEqual = (fieldA, fieldB) => {
        return fieldA.x == fieldB.x &&
          fieldA.z == fieldB.z;
      },
      startFieldIndex = fields.findIndex((field)=> areFieldsEqual(field, pawn)),
      startField = startFieldIndex > -1 && fields[startFieldIndex];
    log(startFieldIndex);
    log(startField);
    log(pawn);
    if (!startField) return;

    // For every pawn

    // Search twice cause when: startFieldIndex = fields.length-1
    // => search fields from start
    for(let i = startFieldIndex + 1; i < fields.length * 2 && !endField; i++) {
      let fieldIndex = i % fields.length,
        field = fields[fieldIndex];

      if (startField.type === FieldType.spawn) {
        if (diceNumber === 6) {
          if (field.type === FieldType.start) {
            length++;
            endField = field;
            break;
          }
        } else {
          return;
        }
      } else {
        if(checkField({startField, endField: field, diceNumber, pawn})) {
          length++;
        }
      }

      if (length >= diceNumber) {
        endField = field;
      }
    }
    // endField = fields[startFieldIndex + length];
    pawn.z = endField.z;
    pawn.x = endField.x;
    return { pawnId: pawn.id, endField, length};
  };
</script>
</body>
</html>